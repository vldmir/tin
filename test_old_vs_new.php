<?php

require_once 'vendor/autoload.php';

use vldmir\Tin\TIN;
use vldmir\Tin\Exception\TINException;

echo "\n=== –°–†–ê–í–ù–ï–ù–ò–ï –°–¢–ê–†–û–ô –ò –ù–û–í–û–ô –õ–û–ì–ò–ö–ò –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–ò ===\n\n";

echo "üìö –ò–ó CHANGELOG 2.0.5:\n";
echo "‚ùå –°–¢–ê–†–ê–Ø –ª–æ–≥–∏–∫–∞ (–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):\n";
echo "   TIN::normalizeTin() - regex: #[^[:alnum:]\\-+]#u (–æ—Å—Ç–∞–≤–ª—è–ª –¥–µ—Ñ–∏—Å—ã –∏ –ø–ª—é—Å—ã)\n";
echo "   CountryHandler::normalizeTin() - regex: #[^[:alnum:]]#u (—É–±–∏—Ä–∞–ª –í–°–ï —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã)\n";
echo "   –†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–ï–°–û–ì–õ–ê–°–û–í–ê–ù–ù–û–°–¢–¨ –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏!\n\n";

echo "‚úÖ –ù–û–í–ê–Ø –ª–æ–≥–∏–∫–∞ (–ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):\n";
echo "   –û–±–∞ –∫–ª–∞—Å—Å–∞: regex: #[^[:alnum:]]#u (—É–±–∏—Ä–∞—é—Ç –í–°–ï —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã)\n";
echo "   –†–µ–∑—É–ª—å—Ç–∞—Ç: –°–û–ì–õ–ê–°–û–í–ê–ù–ù–û–°–¢–¨!\n\n";

echo "üîç –ü–†–û–í–ï–†–ö–ê –†–ê–ó–õ–ò–ß–ò–ô:\n\n";

$testInputs = [
    '26954371827',      // –ë–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    '269 543 718 27',   // –° –ø—Ä–æ–±–µ–ª–∞–º–∏
    '269-543-718-27',   // –° –¥–µ—Ñ–∏—Å–∞–º–∏
    '269.543.718.27',   // –° —Ç–æ—á–∫–∞–º–∏
    '269+543+718+27',   // –° –ø–ª—é—Å–∞–º–∏
];

foreach ($testInputs as $input) {
    echo "–í—Ö–æ–¥: '$input'\n";
    
    // –°–∏–º—É–ª—è—Ü–∏—è –°–¢–ê–†–û–ô –ª–æ–≥–∏–∫–∏ TIN::normalizeTin()
    $oldTinNormalization = preg_replace('#[^[:alnum:]\-+]#u', '', $input);
    $oldTinNormalization = strtoupper($oldTinNormalization);
    
    // –°–∏–º—É–ª—è—Ü–∏—è –°–¢–ê–†–û–ô –ª–æ–≥–∏–∫–∏ CountryHandler::normalizeTin() (—É–∂–µ –±—ã–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è)
    $oldCountryHandlerNormalization = preg_replace('#[^[:alnum:]]#u', '', $input);
    $oldCountryHandlerNormalization = strtoupper($oldCountryHandlerNormalization);
    
    // –¢–µ–∫—É—â–∞—è (–ù–û–í–ê–Ø) –ª–æ–≥–∏–∫–∞ - –æ–±–∞ –∫–ª–∞—Å—Å–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ
    $newNormalization = preg_replace('#[^[:alnum:]]#u', '', $input);
    $newNormalization = strtoupper($newNormalization);
    
    echo "  –°—Ç–∞—Ä–∞—è TIN::normalizeTin():           '$oldTinNormalization'\n";
    echo "  –°—Ç–∞—Ä–∞—è CountryHandler::normalizeTin(): '$oldCountryHandlerNormalization'\n";
    echo "  –ù–æ–≤–∞—è (–æ–±–µ): '$newNormalization'\n";
    
    if ($oldTinNormalization !== $oldCountryHandlerNormalization) {
        echo "  üî• –ö–û–ù–§–õ–ò–ö–¢! –°—Ç–∞—Ä—ã–µ –º–µ—Ç–æ–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ —Ä–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!\n";
    } else {
        echo "  ‚úÖ –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ\n";
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    try {
        $tin = TIN::from('DE', $input);
        $isValid = $tin->isValid();
        echo "  –¢–µ–∫—É—â–∞—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å: " . ($isValid ? '–í–ê–õ–ò–î–ï–ù' : '–ù–ï–í–ê–õ–ò–î–ï–ù') . "\n";
    } catch (TINException $e) {
        echo "  –¢–µ–∫—É—â–∞—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å: –û–®–ò–ë–ö–ê - " . $e->getMessage() . "\n";
    }
    
    echo "\n";
}

echo "üéØ –û–ë–™–Ø–°–ù–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´:\n";
echo "–î–æ –≤–µ—Ä—Å–∏–∏ 2.0.5 –≤—Ö–æ–¥—ã —Å –ü–†–û–ë–ï–õ–ê–ú–ò –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ:\n";
echo "1. TIN::parse() –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–ª '269 543 718 27' ‚Üí '269-543-718-27' (–æ—Å—Ç–∞–≤–ª—è–ª –¥–µ—Ñ–∏—Å—ã)\n";
echo "2. CountryHandler –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–ª –∏ –æ–∂–∏–¥–∞–ª '26954371827' (–±–µ–∑ –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤)\n";
echo "3. –†–µ–∑—É–ª—å—Ç–∞—Ç: '269-543-718-27' ‚â† '26954371827' ‚Üí –ù–ï–í–ê–õ–ò–î–ï–ù\n\n";

echo "–¢–µ–ø–µ—Ä—å –æ–±–∞ –º–µ—Ç–æ–¥–∞ –¥–µ–ª–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ:\n";
echo "'269 543 718 27' ‚Üí '26954371827' ‚Üí –í–ê–õ–ò–î–ï–ù ‚úÖ\n\n";

echo "üìã –í–´–í–û–î:\n";
echo "‚úÖ –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª–∏—Å—å –¢–û–õ–¨–ö–û –¥–µ—Ñ–∏—Å—ã –∏ –ø–ª—é—Å—ã\n";
echo "‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –í–°–ï —Å–∏–º–≤–æ–ª—ã (–ø—Ä–æ–±–µ–ª—ã, —Ç–æ—á–∫–∏, –¥–µ—Ñ–∏—Å—ã, etc.)\n";
echo "‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å –°–û–ì–õ–ê–°–û–í–ê–ù–ê –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏\n\n";

echo "=== –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù ===\n"; 