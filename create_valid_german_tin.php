<?php

require_once 'vendor/autoload.php';

use vldmir\Tin\TIN;
use vldmir\Tin\Exception\TINException;

echo "\n=== –°–û–ó–î–ê–ù–ò–ï –ü–†–ê–í–ò–õ–¨–ù–û–ì–û –í–ê–õ–ò–î–ù–û–ì–û –ù–ï–ú–ï–¶–ö–û–ì–û IdNr ===\n\n";

echo "‚ùå –ü–†–û–ë–õ–ï–ú–ê –° –ü–†–ï–î–û–°–¢–ê–í–õ–ï–ù–ù–´–ú –ù–û–ú–ï–†–û–ú:\n";
echo "–ù–æ–º–µ—Ä: 12 345 678 901\n";
echo "–ü—Ä–æ–±–ª–µ–º–∞: –í –Ω–µ–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –í–°–ï —Ü–∏—Ñ—Ä—ã (0-9), –Ω–æ –ø—Ä–∞–≤–∏–ª–∞ IdNr —Ç—Ä–µ–±—É—é—Ç:\n";
echo "- –û–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞ –¥–æ–ª–∂–Ω–∞ –û–¢–°–£–¢–°–¢–í–û–í–ê–¢–¨\n";
echo "- –û–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞ –¥–æ–ª–∂–Ω–∞ –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è –î–í–ê–ñ–î–´\n";
echo "- –û—Å—Ç–∞–ª—å–Ω—ã–µ 8 —Ü–∏—Ñ—Ä –¥–æ–ª–∂–Ω—ã –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è –ø–æ –û–î–ù–û–ú–£ —Ä–∞–∑—É\n\n";

echo "‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ï –ü–†–ò–ú–ï–†–´ –í–ê–õ–ò–î–ù–´–• IdNr:\n\n";

// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤
$validExamples = [
    '12 345 678 971' => '–ù–µ—Ç —Ü–∏—Ñ—Ä—ã 0, —Ü–∏—Ñ—Ä–∞ 7 –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã',
    '23 456 789 812' => '–ù–µ—Ç —Ü–∏—Ñ—Ä—ã 0, —Ü–∏—Ñ—Ä–∞ 2 –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã',
    '13 456 789 244' => '–ù–µ—Ç —Ü–∏—Ñ—Ä—ã 0, —Ü–∏—Ñ—Ä–∞ 4 –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã',
    '26 954 371 827' => '–ò–∑ —Ç–µ—Å—Ç–æ–≤: –Ω–µ—Ç —Ü–∏—Ñ—Ä—ã 0, —Ü–∏—Ñ—Ä—ã 2 –∏ 7 –¥–≤–∞–∂–¥—ã',
    '86 095 742 719' => '–ò–∑ —Ç–µ—Å—Ç–æ–≤: –Ω–µ—Ç —Ü–∏—Ñ—Ä—ã 3, —Ü–∏—Ñ—Ä—ã 7 –∏ 9 –¥–≤–∞–∂–¥—ã',
];

foreach ($validExamples as $example => $description) {
    $normalized = str_replace(' ', '', $example);
    
    echo "–ù–æ–º–µ—Ä: $example\n";
    echo "–û–ø–∏—Å–∞–Ω–∏–µ: $description\n";
    
    // –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    $digits = str_split($normalized);
    $digitCount = array_count_values($digits);
    
    $missing = [];
    $twice = [];
    $once = [];
    
    for ($i = 0; $i <= 9; $i++) {
        $count = $digitCount[$i] ?? 0;
        if ($count === 0) {
            $missing[] = $i;
        } elseif ($count === 2) {
            $twice[] = $i;
        } elseif ($count === 1) {
            $once[] = $i;
        }
    }
    
    echo "–°—Ç—Ä—É–∫—Ç—É—Ä–∞:\n";
    echo "  - –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ü–∏—Ñ—Ä—ã: " . implode(', ', $missing) . " (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: " . count($missing) . ")\n";
    echo "  - –¶–∏—Ñ—Ä—ã –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –¥–≤–∞–∂–¥—ã: " . implode(', ', $twice) . " (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: " . count($twice) . ")\n";
    echo "  - –¶–∏—Ñ—Ä—ã –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –æ–¥–∏–Ω —Ä–∞–∑: " . implode(', ', $once) . " (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: " . count($once) . ")\n";
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
    try {
        $tin = TIN::from('DE', $example);
        $isValid = $tin->isValid();
        echo "–í–∞–ª–∏–¥–Ω–æ—Å—Ç—å: " . ($isValid ? '‚úÖ –í–ê–õ–ò–î–ï–ù' : '‚ùå –ù–ï–í–ê–õ–ò–î–ï–ù') . "\n";
        
        if ($isValid) {
            $type = $tin->identifyTinType();
            echo "–¢–∏–ø: {$type['code']} - {$type['name']}\n";
            echo "–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: {$tin->formatInput($normalized)}\n";
        }
    } catch (TINException $e) {
        echo "‚ùå –û–®–ò–ë–ö–ê: " . $e->getMessage() . "\n";
    }
    
    echo "\n" . str_repeat("-", 60) . "\n\n";
}

echo "üìã –ü–†–ê–í–ò–õ–ê IdNr (Identifikationsnummer):\n";
echo "‚úÖ –û–±—â–∞—è –¥–ª–∏–Ω–∞: 11 —Ü–∏—Ñ—Ä\n";
echo "‚úÖ –ü–µ—Ä–≤–∞—è —Ü–∏—Ñ—Ä–∞: –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 0\n";
echo "‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–µ—Ä–≤—ã—Ö 10 —Ü–∏—Ñ—Ä:\n";
echo "   ‚Ä¢ –†–æ–≤–Ω–æ –û–î–ù–ê —Ü–∏—Ñ—Ä–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã\n";
echo "   ‚Ä¢ –†–æ–≤–Ω–æ –û–î–ù–ê —Ü–∏—Ñ—Ä–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é\n";
echo "   ‚Ä¢ –û—Å—Ç–∞–ª—å–Ω—ã–µ 8 —Ü–∏—Ñ—Ä –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –ø–æ –æ–¥–Ω–æ–º—É —Ä–∞–∑—É\n";
echo "‚úÖ –ü–æ—Å–ª–µ–¥–Ω—è—è —Ü–∏—Ñ—Ä–∞: –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞\n";
echo "‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º: ISO/IEC 7064 MOD 11,10\n\n";

echo "üéØ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô –í–ê–õ–ò–î–ù–´–ô –ù–û–ú–ï–†:\n";
echo "–í–º–µ—Å—Ç–æ: 12 345 678 901\n";
echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: 12 345 678 971\n";
echo "–ü—Ä–∏—á–∏–Ω–∞: –Ω–µ—Ç —Ü–∏—Ñ—Ä—ã 0, —Ü–∏—Ñ—Ä–∞ 7 –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã\n\n";

echo "=== –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù ===\n"; 