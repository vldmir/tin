<?php

require_once 'vendor/autoload.php';

use vldmir\Tin\TIN;
use vldmir\Tin\Exception\TINException;

echo "\n=== –î–µ—Ç–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≥–µ—Ä–º–∞–Ω—Å–∫–æ–≥–æ –¢–ò–ù ===\n\n";

// –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–º–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
$tin = TIN::from('DE', '26954371827');

echo "üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–µ—Ä–º–∞–Ω—Å–∫–æ–º –¢–ò–ù:\n";
echo "–ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã: DE\n";
echo "–ú–∞—Å–∫–∞ –≤–≤–æ–¥–∞: {$tin->getInputMask()}\n";
echo "–ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä: {$tin->getPlaceholder()}\n";
echo "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –¢–ò–ù:\n";
foreach ($tin->getTinTypes() as $type) {
    echo "  - {$type['code']}: {$type['name']} ({$type['description']})\n";
}

echo "\nüìä –í–∞–ª–∏–¥–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ —Ç–µ—Å—Ç–æ–≤:\n";
$validExamples = [
    '26954371827' => 'Identifikationsnummer (IdNr)',
    '86095742719' => 'Identifikationsnummer (IdNr)',
    '65929970489' => 'Steuernummer (StNr)',
];

foreach ($validExamples as $number => $expectedType) {
    $tin = TIN::from('DE', $number);
    $type = $tin->identifyTinType();
    
    echo "  ‚úì $number - {$expectedType}\n";
    echo "    –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å: " . ($tin->isValid() ? '–î–ê' : '–ù–ï–¢') . "\n";
    echo "    –¢–∏–ø: {$type['name']}\n";
    echo "    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: {$tin->formatInput($number)}\n";
    
    // –ü—Ä–æ–≤–µ—Ä–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    echo "    –ê–Ω–∞–ª–∏–∑:\n";
    echo "      - –î–ª–∏–Ω–∞: " . strlen($number) . " (—Ç—Ä–µ–±—É–µ—Ç—Å—è: 11)\n";
    echo "      - –ü–µ—Ä–≤–∞—è —Ü–∏—Ñ—Ä–∞: {$number[0]} (–Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 0)\n";
    echo "      - –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ü–∏—Ñ—Ä–∞: {$number[10]}\n";
    echo "      - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–∏—Ñ—Ä: ";
    $digits = str_split($number);
    $digitCount = array_count_values($digits);
    foreach ($digitCount as $digit => $count) {
        echo "$digit($count) ";
    }
    echo "\n";
    
    // –ü—Ä–æ–≤–µ—Ä–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è IdNr
    if ($type['code'] === 'IdNr') {
        echo "      - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è IdNr:\n";
        echo "        ‚Ä¢ –¢–æ—á–Ω–æ –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã\n";
        echo "        ‚Ä¢ –¢–æ—á–Ω–æ –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç\n";
        echo "        ‚Ä¢ –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –ø–æ –æ–¥–Ω–æ–º—É —Ä–∞–∑—É\n";
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è StNr
    if ($type['code'] === 'StNr') {
        echo "      - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è StNr:\n";
        echo "        ‚Ä¢ –ù–µ—Ç —Ç—Ä–µ—Ö –ø–æ–¥—Ä—è–¥ –∏–¥—É—â–∏—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ü–∏—Ñ—Ä\n";
        echo "        ‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –æ–¥–Ω–æ–π —Ü–∏—Ñ—Ä—ã\n";
        echo "        ‚Ä¢ –ú–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è 2 –∏–ª–∏ 3 —Ä–∞–∑–∞\n";
    }
    
    echo "\n";
}

echo "\n‚ùå –¢–µ—Å—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤:\n";
$invalidTests = [
    '26954371828' => '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞',
    '860957427199' => '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ (12 —Ü–∏—Ñ—Ä)',
    '02345678901' => '–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0',
    '11111111111' => '–í—Å–µ —Ü–∏—Ñ—Ä—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ',
    '12345678900' => '–¢—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ü–∏—Ñ—Ä—ã –ø–æ–¥—Ä—è–¥ (000)',
    '12345567890' => '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–∏—Ñ—Ä',
];

foreach ($invalidTests as $number => $reason) {
    try {
        $tin = TIN::from('DE', $number);
        $isValid = $tin->isValid();
        echo "  ‚úó $number - " . ($isValid ? '–í–ê–õ–ò–î–ï–ù (–Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ!)' : '–ù–ï–í–ê–õ–ò–î–ï–ù') . " - $reason\n";
    } catch (TINException $e) {
        echo "  ‚úì $number - –û–¢–ö–õ–û–ù–ï–ù - $reason\n";
    }
}

echo "\nüîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:\n";
$formatTests = [
    '26954371827',
    '269 543 718 27',
    '269-543-718-27',
    '269.543.718.27',
];

foreach ($formatTests as $input) {
    try {
        $tin = TIN::from('DE', $input);
        echo "  –í—Ö–æ–¥: '$input' ‚Üí –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å: " . ($tin->isValid() ? '–î–ê' : '–ù–ï–¢') . "\n";
    } catch (TINException $e) {
        echo "  –í—Ö–æ–¥: '$input' ‚Üí –û–®–ò–ë–ö–ê: " . $e->getMessage() . "\n";
    }
}

echo "\nüéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã:\n";
echo "–î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø—Ä–æ–≤–µ—Ä–∏–º —Ä–∞—Å—á–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã:\n";

// –ü—Ä–æ–≤–µ—Ä–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è IdNr (–∞–ª–≥–æ—Ä–∏—Ç–º 1)
$testIdNr = '26954371827';
echo "IdNr: $testIdNr\n";
echo "–ê–ª–≥–æ—Ä–∏—Ç–º: —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å –æ—Å—Ç–∞—Ç–∫–æ–º –æ—Ç –¥–µ–ª–µ–Ω–∏—è\n";

// –ü—Ä–æ–≤–µ—Ä–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è StNr (–∞–ª–≥–æ—Ä–∏—Ç–º 2)  
$testStNr = '65929970489';
echo "StNr: $testStNr\n";
echo "–ê–ª–≥–æ—Ä–∏—Ç–º: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å –≤–µ—Å–æ–≤—ã–º–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏\n";

echo "\nüîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–≤–æ–¥–∞:\n";
echo "–ü—Ä–æ–≤–µ—Ä–∏–º, –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:\n";

$normalizeTests = [
    '26954371827',
    '269 543 718 27',
    '269-543-718-27',
    '269.543.718.27',
    '269/543/718/27',
];

foreach ($normalizeTests as $input) {
    try {
        $tin = TIN::from('DE', $input);
        echo "  '$input' ‚Üí –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å: " . ($tin->isValid() ? '–î–ê' : '–ù–ï–¢') . "\n";
    } catch (TINException $e) {
        echo "  '$input' ‚Üí –û–®–ò–ë–ö–ê: " . $e->getMessage() . "\n";
    }
}

echo "\n‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!\n";
echo "\nüìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ:\n";
echo "‚úì –í–∞–ª–∏–¥–∞—Ü–∏—è –≥–µ—Ä–º–∞–Ω—Å–∫–æ–≥–æ –¢–ò–ù —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n";
echo "‚úì –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –¥–≤–∞ —Ç–∏–ø–∞ –¢–ò–ù: IdNr –∏ StNr\n";
echo "‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤–≤–æ–¥–∞\n";
echo "‚úì –ê–ª–≥–æ—Ä–∏—Ç–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n";
echo "‚úì –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n"; 